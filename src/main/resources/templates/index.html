<!DOCTYPE html>
<html>
<head>
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

    <link href="
https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css
" rel="stylesheet">
    <script src="
https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.min.js
"></script>
</head>
<body>
    <div id="map" style="height: 50em;"></div>
    


    <div id="news" class="row row-cols-1 row-cols-md-3 g-4"
    style="height: 50em; overflow-y: scroll;">

     

    </div>








</body>
</html>
<script type="text/javascript" src="countries.js"></script>
<script type="text/javascript" src="utils.js"></script>
<script>
    var map = L.map('map').setView([49.183, -0.35], 13);

    map.createPane('labels');
    map.getPane('labels').style.zIndex = 650;
    map.getPane('labels').style.pointerEvents = 'none';

    var positron = L.tileLayer('https://{s}.basemaps.cartocdn.com/light_nolabels/{z}/{x}/{y}.png', {
        attribution: '©OpenStreetMap, ©CartoDB'
    }).addTo(map);

    var positronLabels = L.tileLayer('https://{s}.basemaps.cartocdn.com/light_only_labels/{z}/{x}/{y}.png', {
            attribution: '©OpenStreetMap, ©CartoDB',
            pane: 'labels'
    }).addTo(map);

    var geojson = L.geoJson(countries).addTo(map);
    
    geojson.eachLayer(function (layer) {
        var countryName = layer.feature.properties.name
        var countryId = layer.feature.properties.id
        layer.bindPopup(countryName);
        layer.on('click', function(event){

            var divNews = document.getElementById("news");
            
            console.log("hey "+countryName+" id: "+countryId);


            var data = {
                "name":countryName,
                "id":countryId
            }
            var xhr = new XMLHttpRequest();
            xhr.open("POST", "http://localhost:8081/demo/news", true);
            xhr.setRequestHeader("Accept", "application/json");
            xhr.setRequestHeader("Content-Type", "application/json");
            
            xhr.send(JSON.stringify(data));

           // 4. This will be called after the response is received
            xhr.onload = function() {
                
                divNews.textContent = "";
                const ob = JSON.parse(xhr.responseText);
                const ob_length = ob.length;
  
                ob.forEach(element => {
                    
                    const card = createCard(element);
                    divNews.appendChild(card);

                    console.log(Date.parse(element.timestamp));

                });
            };

        })
    });

    map.fitBounds(geojson.getBounds());

    /*
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        maxZoom: 30,
    }).addTo(map);
    */
</script>