<!DOCTYPE html>
<html>
<head>
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <link rel="stylesheet" src="utils.css"/>
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

    <link href="
https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css
" rel="stylesheet">
    <script src="
https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.min.js
"></script>
</head>
<body class="bg-secondary">

    <div class="container-lg">

        <div class="row" style="margin-top: 15%;">

        <div class="col">    
            <div class="shadow p-2" style="width: 100%;">
                <div class="border border-5 rounded" id="map" style="height: 600px; width:100%"></div>
            </div>
        </div>

        <div class="col">
            <div class="row">
            <ul class="nav m-2 nav-tabs" id="tabNews" role="tablist">
                <li class="nav-item" role="presentation">
                  <button class="nav-link active" id="cards-tab" data-bs-toggle="tab"
                  data-bs-target="#news" type="button" role="tab" 
                  aria-controls="news" aria-selected="true">Cards</button>
                </li>
                <li class="nav-item" role="presentation">
                  <button class="nav-link" id="tab-tab" data-bs-toggle="tab"
                  data-bs-target="#tab-tab-pane" type="button" role="tab" 
                  aria-controls="tab-tab-pane" aria-selected="false">Tab</button>
                </li>
                
              </ul>
            </div>

            <div class="row mb-3 p-2 tab-content">
                <div id="news" class="row row-cols-1 row-cols-md-3 g-4 tab-pane fade show active" 
                style="height: 600px;overflow-y: scroll; width: 100%;" tabindex="0"></div>
               
                <div class="tab-pane fade" id="tab-tab-pane" role="tabpanel" tabindex="0" style="width: 40em;overflow-x: auto;">
                    
                    <table class="table table-dark table-hover">
                        <thead>
                            <tr>
                              <th scope="col">#</th>
                              <th scope="col">Title</th>
                              <th scope="col">Source</th>
                            </tr>
                          </thead>
                          <tbody id="tab-body-news">
                          
                          </tbody>
                    </table>
             

                </div>
            </div>

        </div>

        </div>

    </div>





</body>
</html>
<script type="text/javascript" src="countries.js"></script>
<script type="text/javascript" src="utils.js"></script>
<script>
    var map = L.map('map').setView([49.183, -0.35], 13);

    map.createPane('labels');
    map.getPane('labels').style.zIndex = 650;
    map.getPane('labels').style.pointerEvents = 'none';

    var positron = L.tileLayer('https://{s}.basemaps.cartocdn.com/light_nolabels/{z}/{x}/{y}.png', {
        attribution: '©OpenStreetMap, ©CartoDB'
    }).addTo(map);

    var positronLabels = L.tileLayer('https://{s}.basemaps.cartocdn.com/light_only_labels/{z}/{x}/{y}.png', {
            attribution: '©OpenStreetMap, ©CartoDB',
            pane: 'labels'
    }).addTo(map);

    var geojson = L.geoJson(countries).addTo(map);
    
    geojson.eachLayer(function (layer) {
        var countryName = layer.feature.properties.name
        var countryId = layer.feature.properties.id
        layer.bindPopup(countryName);
        layer.on('click', function(event){

            var divNews = document.getElementById("news");
            var tabBodyNews = document.getElementById("tab-body-news");

            console.log("hey "+countryName+" id: "+countryId);


            var data = {
                "name":countryName,
                "id":countryId
            }
            var xhr = new XMLHttpRequest();
            xhr.open("POST", "http://localhost:8081/demo/news", true);
            xhr.setRequestHeader("Accept", "application/json");
            xhr.setRequestHeader("Content-Type", "application/json");
            
            xhr.send(JSON.stringify(data));

           // 4. This will be called after the response is received
            xhr.onload = function() {
                
                divNews.textContent = "";
                tabBodyNews.textContent = "";
                const ob = JSON.parse(xhr.responseText);
                const ob_length = ob.length;
                
                shuffle(ob);
                ob.forEach(element => {
                    
                    const card = createCard(element);
                    divNews.appendChild(card);

                    const row = createTable(element);
                    tabBodyNews.appendChild(row);

                    



                });
            };

        })
    });

    map.fitBounds(geojson.getBounds());

    /*
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        maxZoom: 30,
    }).addTo(map);
    */
</script>